name: Build and PR Binaries

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:

  build-msdf-atlas-gen-linux-arm64:
    name: msdf-atlas-gen (linux/arm64)
    runs-on: ubuntu-22.04-arm
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Install Build Dependencies (packages)
        run: |
          apt-get update
          apt-get install -y --no-install-recommends \
            build-essential \
            ca-certificates \
            cmake \
            curl \
            git \
            ninja-build \
            pkg-config \
            python3 \
            tar \
            unzip \
            zip
      - name: Install Build Dependencies (vcpkg)
        run: |
          git clone https://github.com/microsoft/vcpkg ${{ env.RUNNER_TEMP }}/vcpkg
          cd ${{ env.RUNNER_TEMP }}/vcpkg
          ./bootstrap-vcpkg.sh
          echo "VCPKG_ROOT=${{ env.RUNNER_TEMP }}/vcpkg" >> $GITHUB_ENV
      - name: Build msdf-atlas-gen
        run: |
          git clone --recurse-submodules https://github.com/Chlumsky/msdf-atlas-gen.git ${{ env.RUNNER_TEMP }}/msdf-atlas-gen && \
          cd ${{ env.RUNNER_TEMP }}/msdf-atlas-gen && \
          cmake -S . -B build -G Ninja -DCMAKE_BUILD_TYPE=Release && \
          cmake --build build
      - name: Upload binary
        uses: actions/upload-artifact@v4
        with:
          name: msdf-atlas-gen-linux-arm64
          path: ${{ env.RUNNER_TEMP }}/msdf-atlas-gen/build/bin/msdf-atlas-gen
